<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Royal Touch</title>

  <!-- Ù…Ù„Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ù…ÙˆÙ‚Ø¹ -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙˆÙŠØ© â€“ Ø²Ù‡Ø±ÙŠ ÙˆØ°Ù‡Ø¨ÙŠ */
    :root {
      --rt-pink: #f8a7c4;
      --rt-pink-dark: #e46b9d;
      --rt-gold: #f5c76d;
      --rt-gold-dark: #c99b3a;
      --rt-bg: #0f0f1a;
      --rt-card: #181826;
      --rt-text: #ffffff;
      --rt-muted: #9ba0b8;
      --rt-danger: #ff6b81;
      --rt-success: #38c172;
    }

    body.admin-body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1f1024, #050510);
      color: var(--rt-text);
    }

    /* ====== Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====== */
    .admin-login-wrapper {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }

    .admin-login-card {
      background: linear-gradient(135deg, #201428, #141424);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      padding: 2rem 1.75rem;
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .admin-logo-box {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .admin-logo-box img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      border-radius: 999px;
      border: 2px solid var(--rt-gold);
      background: #1c1c2a;
      padding: 6px;
    }

    .admin-logo-box h1 {
      margin: 0.75rem 0 0.25rem;
      font-size: 1.4rem;
      letter-spacing: 1px;
      color: var(--rt-gold);
    }

    .admin-logo-box p {
      margin: 0;
      font-size: 0.9rem;
      color: var(--rt-muted);
    }

    .admin-input-group {
      margin-bottom: 1rem;
    }

    .admin-input-label {
      display: block;
      margin-bottom: 0.25rem;
      font-size: 0.85rem;
      color: var(--rt-muted);
    }

    .admin-input {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(4, 4, 20, 0.9);
      color: var(--rt-text);
      font-size: 0.95rem;
      outline: none;
      transition: 0.2s border, 0.2s box-shadow, 0.2s background;
    }

    .admin-input:focus {
      border-color: var(--rt-pink);
      box-shadow: 0 0 0 1px rgba(248, 167, 196, 0.4);
      background: rgba(8, 8, 28, 0.95);
    }

    .admin-btn-main {
      width: 100%;
      padding: 0.7rem 0.75rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--rt-pink), var(--rt-gold));
      color: #190818;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.25rem;
      transition: 0.2s transform, 0.2s box-shadow, 0.2s filter;
    }

    .admin-btn-main:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
      filter: brightness(1.05);
    }

    .admin-login-footer {
      margin-top: 0.75rem;
      font-size: 0.8rem;
      text-align: center;
      color: var(--rt-muted);
    }

    .admin-error,
    .admin-success {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      text-align: center;
    }

    .admin-error {
      color: var(--rt-danger);
    }

    .admin-success {
      color: var(--rt-success);
    }

    /* ====== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ====== */
    .admin-app.hidden {
      display: none;
    }

    .admin-layout {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .admin-topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.7rem 1rem;
      background: linear-gradient(90deg, #1d1020, #111122);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .admin-top-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .admin-top-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      object-fit: contain;
      border: 2px solid var(--rt-pink);
      background: #20142a;
      padding: 3px;
    }

    .admin-top-title {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .admin-top-title span:first-child {
      font-size: 0.9rem;
      color: var(--rt-gold);
      font-weight: 600;
    }

    .admin-top-title span:last-child {
      font-size: 0.75rem;
      color: var(--rt-muted);
    }

    .admin-top-right {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.85rem;
      color: var(--rt-muted);
    }

    .admin-badge {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: rgba(248, 167, 196, 0.12);
      color: var(--rt-pink);
      font-size: 0.75rem;
    }

    .admin-btn-outline {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
      background: transparent;
      color: var(--rt-text);
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      cursor: pointer;
      transition: 0.2s background, 0.2s border-color;
    }

    .admin-btn-outline:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--rt-pink);
    }

    .admin-main {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    .admin-sidebar {
      width: 230px;
      background: radial-gradient(circle at top left, #301430, #0b0b16);
      border-inline-end: 1px solid rgba(255, 255, 255, 0.08);
      padding: 0.75rem 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .admin-nav-title {
      font-size: 0.8rem;
      color: var(--rt-muted);
      padding: 0 0.5rem;
      margin-bottom: 0.25rem;
    }

    .admin-nav-btn {
      width: 100%;
      text-align: right;
      padding: 0.55rem 0.75rem;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--rt-text);
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      transition: 0.2s background, 0.2s transform;
    }

    .admin-nav-btn span {
      font-size: 0.78rem;
      color: var(--rt-muted);
    }

    .admin-nav-btn.active {
      background: linear-gradient(90deg, rgba(248, 167, 196, 0.18), rgba(245, 199, 109, 0.18));
      transform: translateX(-2px);
      color: var(--rt-gold);
    }

    .admin-content {
      flex: 1;
      padding: 1rem 1.2rem 1.5rem;
      overflow-y: auto;
    }

    .admin-section {
      display: none;
    }

    .admin-section.active {
      display: block;
    }

    .admin-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
    }

    .admin-section-header h2 {
      margin: 0;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .admin-chip {
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--rt-muted);
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .stat-card {
      background: radial-gradient(circle at top, #2b1632, #11111e);
      border-radius: 14px;
      padding: 0.8rem 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--rt-muted);
      margin-bottom: 0.1rem;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--rt-gold);
    }

    .stat-sub {
      font-size: 0.75rem;
      color: var(--rt-pink);
    }

    /* Ø¬Ø¯ÙˆÙ„ Ø¹Ø§Ù… */
    .admin-table-wrapper {
      background: rgba(12, 12, 24, 0.98);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      overflow-x: auto;
    }

    table.admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .admin-table th,
    .admin-table td {
      padding: 0.5rem 0.6rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      text-align: right;
      white-space: nowrap;
    }

    .admin-table th {
      background: rgba(255, 255, 255, 0.02);
      color: var(--rt-muted);
      font-weight: 500;
    }

    .admin-tag {
      display: inline-flex;
      align-items: center;
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .tag-pending {
      background: rgba(245, 199, 109, 0.16);
      color: var(--rt-gold);
    }

    .tag-confirmed {
      background: rgba(56, 193, 114, 0.18);
      color: var(--rt-success);
    }

    .tag-delivered {
      background: rgba(89, 196, 255, 0.18);
      color: #8bd4ff;
    }

    .tag-cancelled {
      background: rgba(255, 107, 129, 0.18);
      color: var(--rt-danger);
    }

    .admin-btn-xs {
      border-radius: 999px;
      border: none;
      padding: 0.25rem 0.45rem;
      font-size: 0.7rem;
      cursor: pointer;
      margin-inline-start: 0.15rem;
    }

    .btn-xs-gold {
      background: var(--rt-gold-dark);
      color: #1a1010;
    }

    .btn-xs-pink {
      background: var(--rt-pink-dark);
      color: #fff;
    }

    .btn-xs-ghost {
      background: transparent;
      color: var(--rt-muted);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    /* ÙÙ„Ø§ØªØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
    .orders-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
      align-items: center;
      font-size: 0.8rem;
    }

    .orders-filters select {
      padding: 0.35rem 0.6rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(8, 8, 24, 0.95);
      color: var(--rt-text);
      font-size: 0.8rem;
    }

    .orders-filters button {
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--rt-pink), var(--rt-gold));
      font-size: 0.8rem;
      cursor: pointer;
      color: #200812;
    }

    .wa-hint {
      font-size: 0.78rem;
      color: var(--rt-muted);
      margin-top: 0.3rem;
    }

    .wa-hint a {
      color: var(--rt-gold);
      text-decoration: underline;
    }

    /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    .products-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(260px, 1.1fr);
      gap: 0.8rem;
    }

    .admin-card {
      background: rgba(10, 10, 24, 0.98);
      border-radius: 14px;
      padding: 0.75rem 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .admin-card h3 {
      margin: 0 0 0.5rem;
      font-size: 0.95rem;
    }

    .admin-small {
      font-size: 0.72rem;
      color: var(--rt-muted);
    }

    .admin-form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.5rem;
    }

    .admin-form-grid .full {
      grid-column: 1 / -1;
    }

    .admin-checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      margin-top: 0.25rem;
    }

    textarea.admin-input {
      min-height: 70px;
      resize: vertical;
    }

    .admin-form-actions {
      display: flex;
      justify-content: flex-start;
      gap: 0.4rem;
      margin-top: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--rt-pink), var(--rt-gold));
      color: #1b0814;
      border: none;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      font-size: 0.82rem;
      cursor: pointer;
    }

    .btn-secondary {
      background: transparent;
      color: var(--rt-muted);
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 0.45rem 0.9rem;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-danger {
      background: var(--rt-danger);
      color: #fff;
      border-radius: 999px;
      border: none;
      padding: 0.45rem 0.9rem;
      font-size: 0.8rem;
      cursor: pointer;
    }

    /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 0.75rem;
    }

    @media (max-width: 800px) {
      .admin-sidebar {
        display: none;
      }

      .admin-main {
        flex-direction: column;
      }

      .admin-content {
        padding-inline: 0.8rem;
      }

      .products-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>

<body class="admin-body">
  <!-- ========= Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========= -->
  <div id="adminLoginView" class="admin-login-wrapper">
    <div class="admin-login-card">
      <div class="admin-logo-box">
        <!-- Ø¹Ø¯Ù‘Ù„ Ù…Ø³Ø§Ø± Ø§Ù„Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ù…Ù„ÙÙƒ -->
        <img src="logo.png" alt="Royal Touch Logo" />
        <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Royal Touch</h1>
        <p>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
      </div>

      <div class="admin-input-group">
        <label class="admin-input-label" for="loginUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <input id="loginUsername" class="admin-input" type="text" autocomplete="username" value="admin" />
      </div>

      <div class="admin-input-group">
        <label class="admin-input-label" for="loginPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input id="loginPassword" class="admin-input" type="password" autocomplete="current-password" />
      </div>

      <button id="loginBtn" class="admin-btn-main">Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>

      <div id="loginMessage" class="admin-error" style="display:none;"></div>

      <div class="admin-login-footer">
        <span>ÙŠØ­ÙØ¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ù„Ø³Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².</span>
      </div>
    </div>
  </div>

  <!-- ========= Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ========= -->
  <div id="adminApp" class="admin-app hidden">
    <div class="admin-layout">
      <header class="admin-topbar">
        <div class="admin-top-left">
          <img src="logo.png" class="admin-top-logo" alt="Royal Touch logo" />
          <div class="admin-top-title">
            <span>Royal Touch Admin</span>
            <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
          </div>
        </div>
        <div class="admin-top-right">
          <span id="adminWelcomeText">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø¯Ù…Ù†</span>
          <span class="admin-badge">Ù…ØªØ¬Ø± Ø²Ù‡Ø±ÙŠ &amp; Ø°Ù‡Ø¨ÙŠ</span>
          <button id="logoutBtn" class="admin-btn-outline">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
      </header>

      <div class="admin-main">
        <aside class="admin-sidebar">
          <div class="admin-nav-title">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
          <button class="admin-nav-btn active" data-section="statsSection">
            Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            <span>Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</span>
          </button>
          <button class="admin-nav-btn" data-section="ordersSection">
            Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            <span>Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØªØ¨Ø¹</span>
          </button>
          <button class="admin-nav-btn" data-section="productsSection">
            Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶
            <span>Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„</span>
          </button>
          <button class="admin-nav-btn" data-section="settingsSection">
            Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
            <span>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
          </button>
        </aside>

        <main class="admin-content">
          <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ===== -->
          <section id="statsSection" class="admin-section active">
            <div class="admin-section-header">
              <h2>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© <span class="admin-chip">ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù€ API</span></h2>
              <button id="refreshStatsBtn" class="admin-btn-outline">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
            </div>

            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                <div id="statTotalProducts" class="stat-value">â€“</div>
                <div class="stat-sub">ÙŠØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
              </div>

              <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                <div id="statTotalOrders" class="stat-value">â€“</div>
                <div class="stat-sub">Ù…Ù†Ø° Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ´ØºÙŠÙ„</div>
              </div>

              <div class="stat-card">
                <div class="stat-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</div>
                <div id="statPendingOrders" class="stat-value">â€“</div>
                <div class="stat-sub">ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ø±ÙŠØ¹Ø©</div>
              </div>

              <div class="stat-card">
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                <div id="statTotalRevenue" class="stat-value">â€“</div>
                <div class="stat-sub">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
              </div>
            </div>

            <p class="admin-small">
              * ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± <code>/api/admin/stats</code>. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†
              Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.
            </p>
          </section>

          <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª ===== -->
          <section id="ordersSection" class="admin-section">
            <div class="admin-section-header">
              <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª <span class="admin-chip">ØªØ£ÙƒÙŠØ¯ / ØªØ³Ù„ÙŠÙ… / Ø¥Ù„ØºØ§Ø¡</span></h2>
              <button id="refreshOrdersBtn" class="admin-btn-outline">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            </div>

            <div class="orders-filters">
              <span>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©:</span>
              <select id="ordersStatusFilter">
                <option value="">Ø§Ù„ÙƒÙ„</option>
                <option value="pending">Ù…Ø¹Ù„Ù‚Ø©</option>
                <option value="confirmed">Ù…Ø¤ÙƒØ¯Ø©</option>
                <option value="delivered">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                <option value="cancelled">Ù…Ù„ØºØ§Ø©</option>
              </select>
              <button id="applyOrdersFilterBtn">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
            </div>

            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>ÙˆÙ‚Øª Ø§Ù„Ø·Ù„Ø¨</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr>
                </thead>
                <tbody id="ordersTableBody">
                  <tr>
                    <td colspan="8" style="text-align:center; padding:0.75rem;">
                      Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p class="wa-hint">
              Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¥Ø¹Ù„Ø§Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨
              (Business):
              <a id="waNotifyLink" target="_blank"
                href="https://wa.me/218917040244?text=ÙŠÙˆØ¬Ø¯%20Ø·Ù„Ø¨%20Ø¬Ø¯ÙŠØ¯%20Ø¹Ù„Ù‰%20Ù…ØªØ¬Ø±%20Royal%20Touch">
                Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ 0917040244
              </a>
              <br />
              ** Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…ØªØµÙØ­ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø§Ù‡Ø²Ø©
              Ù„Ùƒ Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©.
            </p>
          </section>

          <!-- ===== Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ ===== -->
          <section id="productsSection" class="admin-section">
            <div class="admin-section-header">
              <h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ <span class="admin-chip">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù</span></h2>
              <button id="refreshProductsBtn" class="admin-btn-outline">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            </div>

            <div class="products-layout">
              <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
              <div class="admin-card">
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
                <p class="admin-small">
                  Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ ØµÙ Ù„ØªØ¹Ø¨Ø¦Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„. Ø§Ù„Ø£Ø­Ø¬Ø§Ù… ØªÙØ¹Ø±Ø¶ Ø¨Ø§Ù„Ø´ÙƒÙ„:
                  <code>S(10) / M(5)</code>.
                </p>
                <div class="admin-table-wrapper" style="margin-top:0.4rem;">
                  <table class="admin-table">
                    <thead>
                      <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ù‚Ø³Ù…</th>
                        <th>Ø§Ù„Ø³Ø¹Ø±</th>
                        <th>Ø¹Ø±Ø¶</th>
                        <th>Ø§Ù„Ø£Ø­Ø¬Ø§Ù…</th>
                        <th>Ø­Ø°Ù</th>
                      </tr>
                    </thead>
                    <tbody id="productsTableBody">
                      <tr>
                        <td colspan="6" style="text-align:center; padding:0.7rem;">
                          Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© / Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
              <div class="admin-card">
                <h3 id="productFormTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <p class="admin-small">
                  Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ù…Ø·Ù„ÙˆØ¨Ø©. Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙŠØºØ©:
                  <code>S:10, M:5, L:0</code> (Ø§Ù„Ø­Ø¬Ù…:Ø§Ù„ÙƒÙ…ÙŠØ©).
                </p>
                <form id="productForm">
                  <input type="hidden" id="productId" />

                  <div class="admin-form-grid">
                    <div class="admin-input-group">
                      <label class="admin-input-label" for="productName">Ø§Ø³Ù…
                        Ø§Ù„Ù…Ù†ØªØ¬*</label>
                      <input id="productName" class="admin-input" type="text" required />
                    </div>

                    <div class="admin-input-group">
                      <label class="admin-input-label" for="productCategory">Ø§Ù„Ù‚Ø³Ù… /
                        Ø§Ù„ÙØ¦Ø©*</label>
                      <input id="productCategory" class="admin-input" type="text" required />
                    </div>

                    <div class="admin-input-group">
                      <label class="admin-input-label" for="productPrice">Ø§Ù„Ø³Ø¹Ø±
                        Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ*</label>
                      <input id="productPrice" class="admin-input" type="number" step="0.01"
                        required />
                    </div>

                    <div class="admin-input-group">
                      <label class="admin-input-label" for="productDiscountPrice">Ø³Ø¹Ø±
                        Ø§Ù„Ø¹Ø±Ø¶ (Ø¥Ù† ÙˆØ¬Ø¯)</label>
                      <input id="productDiscountPrice" class="admin-input" type="number"
                        step="0.01" />
                    </div>

                    <div class="admin-input-group full">
                      <label class="admin-input-label" for="productDescription">Ø§Ù„ÙˆØµÙ
                        Ø§Ù„Ù…Ø®ØªØµØ±*</label>
                      <textarea id="productDescription" class="admin-input"
                        required></textarea>
                    </div>

                    <div class="admin-input-group full">
                      <label class="admin-input-label" for="productSizes">Ø§Ù„Ø£Ø­Ø¬Ø§Ù…
                        ÙˆØ§Ù„ÙƒÙ…ÙŠØ©*</label>
                      <input id="productSizes" class="admin-input" type="text" placeholder="S:10, M:5, L:0"
                        required />
                    </div>

                    <div class="admin-input-group full">
                      <label class="admin-input-label" for="productImages">Ø±ÙˆØ§Ø¨Ø·
                        Ø§Ù„ØµÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                      <input id="productImages" class="admin-input" type="text"
                        placeholder="url1.jpg, url2.jpg" />
                    </div>
                  </div>

                  <div class="admin-checkbox-row">
                    <input id="productIsOffer" type="checkbox" />
                    <label for="productIsOffer">Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ø¶Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ© (Offer)</label>
                  </div>

                  <div class="admin-form-actions">
                    <button type="submit" class="btn-primary">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                    <button type="button" id="resetProductFormBtn" class="btn-secondary">
                      ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    </button>
                    <button type="button" id="deleteCurrentProductBtn" class="btn-danger" style="display:none;">
                      Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬
                    </button>
                  </div>

                  <div id="productFormMessage" class="admin-success" style="display:none;"></div>
                </form>
              </div>
            </div>
          </section>

          <!-- ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† ===== -->
          <section id="settingsSection" class="admin-section">
            <div class="admin-section-header">
              <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† <span class="admin-chip">Ø£Ù…Ø§Ù† ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª</span></h2>
            </div>

            <div class="settings-grid">
              <!-- ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
              <div class="admin-card">
                <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
                <p class="admin-small">
                  ÙŠØªØ·Ù„Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø± ÙÙŠ Ø§Ù„Ù€ Backend Ø¨Ø§Ø³Ù…
                  <code>/api/admin/change-password</code> ÙŠØ³ØªÙ‚Ø¨Ù„
                  <code>old_password</code> Ùˆ <code>new_password</code>. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ«
                  Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.
                </p>

                <form id="changePasswordForm">
                  <div class="admin-input-group">
                    <label class="admin-input-label" for="oldPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                      Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                    <input id="oldPassword" class="admin-input" type="password" />
                  </div>

                  <div class="admin-input-group">
                    <label class="admin-input-label" for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                      Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input id="newPassword" class="admin-input" type="password" />
                  </div>

                  <div class="admin-input-group">
                    <label class="admin-input-label" for="newPasswordConfirm">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø©
                      Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input id="newPasswordConfirm" class="admin-input" type="password" />
                  </div>

                  <button type="submit" class="btn-primary">ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>

                  <div id="passwordMessage" class="admin-success" style="display:none;"></div>
                </form>
              </div>

              <!-- Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ -->
              <div class="admin-card">
                <h3>Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</h3>
                <p class="admin-small">
                  ÙŠØªÙ… Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (LocalStorage) ÙˆÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø·
                  Ø³Ø±ÙŠØ¹Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.
                </p>

                <div class="admin-input-group">
                  <label class="admin-input-label" for="waNumberInput">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
                    (Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø¯ÙˆÙ„Ø©)</label>
                  <input id="waNumberInput" class="admin-input" type="text" placeholder="Ù…Ø«Ø§Ù„: 218917040244" />
                </div>
                <button id="saveWaNumberBtn" class="btn-secondary">Ø­ÙØ¸ Ø§Ù„Ø±Ù‚Ù… Ù…Ø­Ù„ÙŠØ§Ù‹</button>

                <p class="admin-small" id="waNumberStatus"></p>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>
  </div>

  <script>
    // ========= Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù€ API =========
    // âœ³ï¸ Ù…Ù‡Ù…: Ø¹Ø¯Ù‘Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙŠÙƒÙˆÙ† Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Backend (FastAPI) Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    const API_BASE_URL = "https://YOUR-BACKEND-URL/api";

    // Ø¹Ù†Ø§ØµØ± Ø¹Ø§Ù…Ø©
    const loginView = document.getElementById("adminLoginView");
    const adminApp = document.getElementById("adminApp");
    const loginUsername = document.getElementById("loginUsername");
    const loginPassword = document.getElementById("loginPassword");
    const loginBtn = document.getElementById("loginBtn");
    const loginMessage = document.getElementById("loginMessage");
    const adminWelcomeText = document.getElementById("adminWelcomeText");
    const logoutBtn = document.getElementById("logoutBtn");

    const navButtons = document.querySelectorAll(".admin-nav-btn");
    const sections = document.querySelectorAll(".admin-section");

    const refreshStatsBtn = document.getElementById("refreshStatsBtn");
    const refreshOrdersBtn = document.getElementById("refreshOrdersBtn");
    const refreshProductsBtn = document.getElementById("refreshProductsBtn");

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    const statTotalProducts = document.getElementById("statTotalProducts");
    const statTotalOrders = document.getElementById("statTotalOrders");
    const statPendingOrders = document.getElementById("statPendingOrders");
    const statTotalRevenue = document.getElementById("statTotalRevenue");

    // Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    const ordersTableBody = document.getElementById("ordersTableBody");
    const ordersStatusFilter = document.getElementById("ordersStatusFilter");
    const applyOrdersFilterBtn = document.getElementById("applyOrdersFilterBtn");
    const waNotifyLink = document.getElementById("waNotifyLink");
    let lastPendingCount = 0;

    // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    const productsTableBody = document.getElementById("productsTableBody");
    const productForm = document.getElementById("productForm");
    const productFormTitle = document.getElementById("productFormTitle");
    const productIdInput = document.getElementById("productId");
    const productNameInput = document.getElementById("productName");
    const productDescriptionInput = document.getElementById("productDescription");
    const productPriceInput = document.getElementById("productPrice");
    const productCategoryInput = document.getElementById("productCategory");
    const productSizesInput = document.getElementById("productSizes");
    const productImagesInput = document.getElementById("productImages");
    const productIsOfferInput = document.getElementById("productIsOffer");
    const productDiscountPriceInput = document.getElementById("productDiscountPrice");
    const resetProductFormBtn = document.getElementById("resetProductFormBtn");
    const deleteCurrentProductBtn = document.getElementById("deleteCurrentProductBtn");
    const productFormMessage = document.getElementById("productFormMessage");

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
    const changePasswordForm = document.getElementById("changePasswordForm");
    const oldPasswordInput = document.getElementById("oldPassword");
    const newPasswordInput = document.getElementById("newPassword");
    const newPasswordConfirmInput = document.getElementById("newPasswordConfirm");
    const passwordMessage = document.getElementById("passwordMessage");
    const waNumberInput = document.getElementById("waNumberInput");
    const saveWaNumberBtn = document.getElementById("saveWaNumberBtn");
    const waNumberStatus = document.getElementById("waNumberStatus");

    // ========= Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© =========
    function getAuthHeaders(isJson = true) {
      const headers = {};
      const token = localStorage.getItem("adminToken");
      if (isJson) headers["Content-Type"] = "application/json";
      if (token) headers["Authorization"] = "Bearer " + token;
      return headers;
    }

    function showLoginError(msg) {
      loginMessage.style.display = "block";
      loginMessage.className = "admin-error";
      loginMessage.textContent = msg;
    }

    function showLoginSuccess(msg) {
      loginMessage.style.display = "block";
      loginMessage.className = "admin-success";
      loginMessage.textContent = msg;
    }

    function switchSection(sectionId) {
      sections.forEach((sec) => {
        sec.classList.toggle("active", sec.id === sectionId);
      });
      navButtons.forEach((btn) => {
        btn.classList.toggle(
          "active",
          btn.getAttribute("data-section") === sectionId
        );
      });
    }

    function tagForStatus(status) {
      const map = {
        pending: "tag-pending",
        confirmed: "tag-confirmed",
        delivered: "tag-delivered",
        cancelled: "tag-cancelled",
      };
      const labelMap = {
        pending: "Ù…Ø¹Ù„Ù‚Ø©",
        confirmed: "Ù…Ø¤ÙƒØ¯Ø©",
        delivered: "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…",
        cancelled: "Ù…Ù„ØºØ§Ø©",
      };
      const cls = map[status] || "tag-pending";
      const label = labelMap[status] || status;
      return `<span class="admin-tag ${cls}">${label}</span>`;
    }

    function parseSizesText(text) {
      if (!text) return [];
      return text
        .split(",")
        .map((part) => part.trim())
        .filter(Boolean)
        .map((pair) => {
          const [size, qty] = pair.split(":");
          return {
            size: (size || "").trim(),
            quantity: Number((qty || "0").trim()) || 0,
          };
        })
        .filter((s) => s.size);
    }

    function sizesToDisplay(sizes) {
      if (!Array.isArray(sizes) || !sizes.length) return "-";
      return sizes
        .map((s) => `${s.size}(${s.quantity ?? 0})`)
        .join(" / ");
    }

    function sizesToTextInput(sizes) {
      if (!Array.isArray(sizes) || !sizes.length) return "";
      return sizes.map((s) => `${s.size}:${s.quantity ?? 0}`).join(", ");
    }

    function imagesToTextInput(images) {
      if (!Array.isArray(images) || !images.length) return "";
      return images.join(", ");
    }

    function normalizeWhatsAppNumber(raw) {
      const digits = (raw || "").replace(/\D/g, "");
      if (!digits) return "";
      return digits;
    }

    function updateWhatsAppLink() {
      const saved = localStorage.getItem("waBusinessNumber") || "218917040244";
      const msg = encodeURIComponent("ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ù…ØªØ¬Ø± Royal Touch");
      waNotifyLink.href = `https://wa.me/${saved}?text=${msg}`;
    }

    // ========= ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„Ø®Ø±ÙˆØ¬ =========
    loginBtn.addEventListener("click", async () => {
      const username = loginUsername.value.trim();
      const password = loginPassword.value;

      if (!username || !password) {
        showLoginError("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.");
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = "Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...";

      try {
        const res = await fetch(`${API_BASE_URL}/admin/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        if (!res.ok) {
          showLoginError("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
        } else {
          const data = await res.json();
          localStorage.setItem("adminToken", data.token || "");
          localStorage.setItem("adminUsername", data.username || username);
          showLoginSuccess("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¢Ù†.");

          // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
          setTimeout(() => {
            initAdminApp();
          }, 400);
        }
      } catch (err) {
        console.error(err);
        showLoginError("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.");
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = "Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…";
      }
    });

    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("adminToken");
      localStorage.removeItem("adminUsername");
      loginPassword.value = "";
      adminApp.classList.add("hidden");
      loginView.style.display = "flex";
    });

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø³Ø§Ø¨Ù‚Ø©
    function checkExistingSession() {
      const token = localStorage.getItem("adminToken");
      if (token) {
        initAdminApp();
      }
    }

    // ========= ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… =========
    function initAdminApp() {
      const username = localStorage.getItem("adminUsername") || "Ø£Ø¯Ù…Ù†";
      adminWelcomeText.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${username}`;

      loginView.style.display = "none";
      adminApp.classList.remove("hidden");

      updateWhatsAppLink();
      const savedWa = localStorage.getItem("waBusinessNumber");
      if (savedWa) {
        waNumberInput.value = savedWa;
        waNumberStatus.textContent = "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸.";
      }

      loadStats();
      loadOrders();
      loadProducts();
    }

    // ========= Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª =========
    async function loadStats() {
      try {
        const res = await fetch(`${API_BASE_URL}/admin/stats`, {
          headers: getAuthHeaders(false),
        });
        if (!res.ok) throw new Error("failed");
        const data = await res.json();
        statTotalProducts.textContent = data.total_products ?? "0";
        statTotalOrders.textContent = data.total_orders ?? "0";
        statPendingOrders.textContent = data.pending_orders ?? "0";
        statTotalRevenue.textContent = data.total_revenue ?? "0";
      } catch (err) {
        console.error("Error loading stats", err);
      }
    }

    refreshStatsBtn.addEventListener("click", loadStats);

    // ========= Ø§Ù„Ø·Ù„Ø¨Ø§Øª =========
    async function loadOrders() {
      const statusFilter = ordersStatusFilter.value;
      let url = `${API_BASE_URL}/orders`;
      if (statusFilter) {
        url += `?status_filter=${encodeURIComponent(statusFilter)}`;
      }

      try {
        const res = await fetch(url, { headers: getAuthHeaders(false) });
        const data = await res.json();
        if (!Array.isArray(data)) {
          throw new Error("bad data");
        }

        if (!data.length) {
          ordersTableBody.innerHTML =
            '<tr><td colspan="8" style="text-align:center; padding:0.75rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</td></tr>';
          return;
        }

        let pendingCount = 0;
        const rows = data
          .map((order, index) => {
            if (order.status === "pending") pendingCount++;
            const customer = order.customer_info || {};
            const date = order.order_date
              ? new Date(order.order_date).toLocaleString("ar-LY")
              : "-";
            const statusHtml = tagForStatus(order.status);
            const total = order.total_amount ?? 0;
            const phone = customer.phone || "-";

            return `
          <tr>
            <td>${index + 1}</td>
            <td>${order.order_number || "-"}</td>
            <td>${customer.name || "-"}</td>
            <td>${phone}</td>
            <td>${total}</td>
            <td>${statusHtml}</td>
            <td>${date}</td>
            <td>
              <button class="admin-btn-xs btn-xs-gold" onclick="updateOrderStatus('${
                order.id
              }','confirmed')">ØªØ£ÙƒÙŠØ¯</button>
              <button class="admin-btn-xs btn-xs-pink" onclick="updateOrderStatus('${
                order.id
              }','delivered')">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
              <button class="admin-btn-xs btn-xs-ghost" onclick="updateOrderStatus('${
                order.id
              }','cancelled')">Ø¥Ù„ØºØ§Ø¡</button>
            </td>
          </tr>
          `;
          })
          .join("");

        ordersTableBody.innerHTML = rows;

        // ØªÙ†Ø¨ÙŠÙ‡ Ù„Ùˆ ÙÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹Ù„Ù‘Ù‚Ø©
        if (pendingCount > lastPendingCount && lastPendingCount !== 0) {
          alert("ğŸ”” ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø£ÙƒØ«Ø± (Ù…Ø¹Ù„Ù‘Ù‚). Ø±Ø§Ø¬Ø¹ Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª.");
        }
        lastPendingCount = pendingCount;
      } catch (err) {
        console.error("Error loading orders", err);
        ordersTableBody.innerHTML =
          '<tr><td colspan="8" style="text-align:center; padding:0.75rem;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª.</td></tr>';
      }
    }

    // Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    window.updateOrderStatus = async function (orderId, newStatus) {
      if (!orderId) return;
      const confirmMsg =
        newStatus === "cancelled"
          ? "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ"
          : "Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ØŸ";
      if (!confirm(confirmMsg)) return;

      try {
        const res = await fetch(
          `${API_BASE_URL}/orders/${orderId}/status?new_status=${encodeURIComponent(
            newStatus
          )}`,
          {
            method: "PUT",
            headers: getAuthHeaders(false),
          }
        );
        if (!res.ok) {
          alert("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨.");
          return;
        }
        await loadOrders();
      } catch (err) {
        console.error("Error updating order status", err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨.");
      }
    };

    refreshOrdersBtn.addEventListener("click", loadOrders);
    applyOrdersFilterBtn.addEventListener("click", loadOrders);

    // ========= Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =========
    async function loadProducts() {
      try {
        const res = await fetch(`${API_BASE_URL}/products`, {
          headers: getAuthHeaders(false),
        });
        const data = await res.json();
        if (!Array.isArray(data) || !data.length) {
          productsTableBody.innerHTML =
            '<tr><td colspan="6" style="text-align:center; padding:0.7rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯.</td></tr>';
          return;
        }

        const rows = data
          .map((p) => {
            const price =
              p.is_offer && p.discount_price ? p.discount_price : p.price;
            const offerLabel = p.is_offer ? "Ø¹Ø±Ø¶" : "-";
            return `
          <tr onclick="fillProductForm('${p.id || ""}')" style="cursor:pointer;">
            <td>${p.name || "-"}</td>
            <td>${p.category || "-"}</td>
            <td>${price ?? 0}</td>
            <td>${offerLabel}</td>
            <td>${sizesToDisplay(p.sizes)}</td>
            <td>
              <button class="admin-btn-xs btn-xs-ghost" onclick="event.stopPropagation(); deleteProduct('${
                p.id
              }');">Ø­Ø°Ù</button>
            </td>
          </tr>
          `;
          })
          .join("");

        productsTableBody.innerHTML = rows;
        window.__productsCache = data;
      } catch (err) {
        console.error("Error loading products", err);
        productsTableBody.innerHTML =
          '<tr><td colspan="6" style="text-align:center; padding:0.7rem;">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.</td></tr>';
      }
    }

    refreshProductsBtn.addEventListener("click", loadProducts);

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬
    window.fillProductForm = function (id) {
      const products = window.__productsCache || [];
      const p = products.find((x) => x.id === id);
      if (!p) return;
      productIdInput.value = p.id || "";
      productNameInput.value = p.name || "";
      productDescriptionInput.value = p.description || "";
      productPriceInput.value = p.price ?? "";
      productCategoryInput.value = p.category || "";
      productSizesInput.value = sizesToTextInput(p.sizes);
      productImagesInput.value = imagesToTextInput(p.images);
      productIsOfferInput.checked = !!p.is_offer;
      productDiscountPriceInput.value = p.discount_price ?? "";

      productFormTitle.textContent = "ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬";
      deleteCurrentProductBtn.style.display = "inline-block";
      productFormMessage.style.display = "none";
    };

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function resetProductForm() {
      productIdInput.value = "";
      productNameInput.value = "";
      productDescriptionInput.value = "";
      productPriceInput.value = "";
      productCategoryInput.value = "";
      productSizesInput.value = "";
      productImagesInput.value = "";
      productDiscountPriceInput.value = "";
      productIsOfferInput.checked = false;
      productFormTitle.textContent = "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯";
      deleteCurrentProductBtn.style.display = "none";
      productFormMessage.style.display = "none";
    }

    resetProductFormBtn.addEventListener("click", resetProductForm);

    // Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„)
    productForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = productIdInput.value.trim();
      const body = {
        name: productNameInput.value.trim(),
        description: productDescriptionInput.value.trim(),
        price: Number(productPriceInput.value),
        category: productCategoryInput.value.trim(),
        sizes: parseSizesText(productSizesInput.value),
        images: (productImagesInput.value || "")
          .split(",")
          .map((x) => x.trim())
          .filter(Boolean),
        is_offer: productIsOfferInput.checked,
        discount_price: productDiscountPriceInput.value
          ? Number(productDiscountPriceInput.value)
          : null,
      };

      const isEdit = !!id;
      const method = isEdit ? "PUT" : "POST";
      const url = isEdit
        ? `${API_BASE_URL}/products/${id}`
        : `${API_BASE_URL}/products`;

      try {
        const res = await fetch(url, {
          method,
          headers: getAuthHeaders(true),
          body: JSON.stringify(body),
        });

        if (!res.ok) {
          productFormMessage.style.display = "block";
          productFormMessage.className = "admin-error";
          productFormMessage.textContent = "ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
          return;
        }

        productFormMessage.style.display = "block";
        productFormMessage.className = "admin-success";
        productFormMessage.textContent = isEdit
          ? "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­."
          : "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.";

        await loadProducts();
        if (!isEdit) resetProductForm();
      } catch (err) {
        console.error("Error saving product", err);
        productFormMessage.style.display = "block";
        productFormMessage.className = "admin-error";
        productFormMessage.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      }
    });

    // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    deleteCurrentProductBtn.addEventListener("click", () => {
      const id = productIdInput.value.trim();
      if (!id) return;
      deleteProduct(id);
    });

    // Ø­Ø°Ù Ù…Ù†ØªØ¬ (Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„Ø¬Ø¯ÙˆÙ„)
    window.deleteProduct = async function (id) {
      if (!id) return;
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;

      try {
        const res = await fetch(`${API_BASE_URL}/products/${id}`, {
          method: "DELETE",
          headers: getAuthHeaders(false),
        });
        if (!res.ok) {
          alert("ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬.");
          return;
        }
        await loadProducts();
        if (productIdInput.value.trim() === id) resetProductForm();
      } catch (err) {
        console.error("Error deleting product", err);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬.");
      }
    };

    // ========= ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± =========
    changePasswordForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const oldPw = oldPasswordInput.value;
      const newPw = newPasswordInput.value;
      const newPw2 = newPasswordConfirmInput.value;

      if (!oldPw || !newPw || !newPw2) {
        passwordMessage.style.display = "block";
        passwordMessage.className = "admin-error";
        passwordMessage.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.";
        return;
      }

      if (newPw !== newPw2) {
        passwordMessage.style.display = "block";
        passwordMessage.className = "admin-error";
        passwordMessage.textContent = "ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†.";
        return;
      }

      try {
        const res = await fetch(`${API_BASE_URL}/admin/change-password`, {
          method: "POST",
          headers: getAuthHeaders(true),
          body: JSON.stringify({
            old_password: oldPw,
            new_password: newPw,
          }),
        });

        if (!res.ok) {
          passwordMessage.style.display = "block";
          passwordMessage.className = "admin-error";
          passwordMessage.textContent =
            "ØªØ¹Ø°Ø± ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±.";
          return;
        }

        passwordMessage.style.display = "block";
        passwordMessage.className = "admin-success";
        passwordMessage.textContent = "ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­.";
        oldPasswordInput.value = "";
        newPasswordInput.value = "";
        newPasswordConfirmInput.value = "";
      } catch (err) {
        console.error("Error changing password", err);
        passwordMessage.style.display = "block";
        passwordMessage.className = "admin-error";
        passwordMessage.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.";
      }
    });

    // ========= Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ =========
    saveWaNumberBtn.addEventListener("click", () => {
      const normalized = normalizeWhatsAppNumber(waNumberInput.value);
      if (!normalized) {
        waNumberStatus.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ§Ù„Ø­.";
        return;
      }
      localStorage.setItem("waBusinessNumber", normalized);
      waNumberStatus.textContent = "ØªÙ… Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­.";
      updateWhatsAppLink();
    });

    // ========= Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… =========
    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const sectionId = btn.getAttribute("data-section");
        switchSection(sectionId);
      });
    });

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    checkExistingSession();
  </script>
</body>
</html>
